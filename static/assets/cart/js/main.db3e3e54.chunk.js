(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{113:function(e,t,n){"use strict";n.r(t);var a=n(66),r=n(28),i=n(21),c=n(22),o=n(23),s=n(17),l=n(127),u=n(24),d=n(0),m=n(18),h=n(42),p=(n(279),Object(m.cn)("Example")),f=function(e){function t(e){return Object(i.a)(this,t),Object(o.a)(this,Object(s.a)(t).call(this,e))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return d.createElement(d.Fragment,null,Object(l.a)(Object(s.a)(t.prototype),"render",this).call(this),d.createElement("div",{className:p()},"Touch"))}}]),t}(h.a),v=new r.Registry({id:"platform"});v.set(p(),f);var b=n(65);Object(a.a)(b.a,v)},114:function(e,t,n){"use strict";n.r(t);var a=n(66),r=n(28),i=n(21),c=n(22),o=n(23),s=n(17),l=n(24),u=n(0),d=n(18),m=n(42),h=(n(139),Object(d.cn)("Example")),p=function(e){function t(e){return Object(i.a)(this,t),Object(o.a)(this,Object(s.a)(t).call(this,e))}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return u.createElement("div",{className:h()},"Desktop")}}]),t}(m.a),f=new r.Registry({id:"platform"});f.set(h(),p);var v=n(65);Object(a.a)(v.a,f)},128:function(e,t,n){e.exports=n(129)},129:function(e,t,n){"use strict";n.r(t);var a=n(115),r=new(n.n(a).a)(window.navigator.userAgent).mobile()?"touch":"desktop";n(131)("./".concat(r))},131:function(e,t,n){var a={"./desktop":114,"./desktop.tsx":114,"./touch":113,"./touch.tsx":113};function r(e){var t=i(e);return n(t)}function i(e){var t=a[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}r.keys=function(){return Object.keys(a)},r.resolve=i,e.exports=r,r.id=131},138:function(e,t,n){},139:function(e,t,n){},140:function(e,t,n){},145:function(e,t,n){},178:function(e,t,n){},195:function(e,t,n){},269:function(e,t,n){},270:function(e,t,n){},278:function(e,t,n){},279:function(e,t,n){},42:function(e,t,n){"use strict";n.d(t,"b",function(){return d}),n.d(t,"a",function(){return m});var a=n(21),r=n(22),i=n(23),c=n(17),o=n(24),s=n(0),l=n(18),u=n(28),d=(n(138),Object(l.cn)("Example")),m=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(i.a)(this,Object(c.a)(t).call(this,e))).state={myState:"foo"},n}return Object(o.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){this.state.myState;return s.createElement(u.RegistryConsumer,null,function(e){return s.createElement("div",{className:d()},s.createElement("header",{className:d("Header")},"Example's header"),s.createElement("main",{className:d("Content")},"Example's content"))})}}]),t}(s.Component)},65:function(e,t,n){"use strict";var a=n(0),r=n.n(a),i=n(18),c=n(28),o=(n(140),n(42)),s=n(21),l=n(22),u=n(23),d=n(17),m=n(24),h=n(46),p=n(305),f=(n(145),Object(i.cn)("Order")),v=Object(h.b)(function(e){return{order:e.order.orders}})(function(e){var t=e.order;return a.createElement("div",{className:f("Aside")},a.createElement("div",{className:f("Aside-Fixed")},a.createElement("div",{className:f("Aside-Fixed-Inner")},a.createElement("div",{className:f("Tickets")},a.createElement("ul",{className:f("Tickets-Ul")},t.map(function(e){return a.createElement("li",{key:(e.title||"")+(e.date||"")+(e.time||""),className:f("Tickets-Li")},a.createElement("h4",{className:f("Tickets-Title")},e.title),a.createElement("dl",null,e.date&&a.createElement("div",{className:f("Tickets-Row")},a.createElement("dt",{className:f("Tickets-Row-Title")},"\u0414\u0430\u0442\u0430:"),a.createElement("dd",{className:f("Tickets-Row-Content")},e.isOpenDate?"isOpenDate":new Date(e.date).toLocaleDateString())),e.time&&a.createElement("div",{className:f("Tickets-Row")},a.createElement("dt",{className:f("Tickets-Row-Title")},"\u0412\u0440\u0435\u043c\u044f:"),a.createElement("dd",{className:f("Tickets-Row-Content")},e.isOpenTime?"isOpenTime":new Date(e.time).toLocaleTimeString())),e.point&&a.createElement("div",{className:f("Tickets-Row")},a.createElement("dt",{className:f("Tickets-Row-Title")},"\u041f\u0440\u0438\u0447\u0430\u043b:"),a.createElement("dd",{className:f("Tickets-Row-Content")},"[",e.point.title,"](",e.point.map,")")),e.tickets&&a.createElement("div",{className:f("Tickets-Row")},a.createElement("dt",{className:f("Tickets-Row-Title")},"\u0411\u0438\u043b\u0435\u0442:"),a.createElement("dd",{className:f("Tickets-Row-Content")},a.createElement("dl",{className:f("Tickets-Col-Inner")},e.tickets.map(function(e){return a.createElement("div",{key:JSON.stringify(e)},a.createElement("dt",{className:f("Tickets-Row-Inner")},a.createElement("span",{className:f("Tickets-Row-Inner-El")},e.count),a.createElement("span",{className:f("Tickets-Row-Inner-El")},a.createElement("span",{className:f("Tickets-Row-Inner-El-Sm")},e.ticket.title," "),a.createElement("i",{className:f("Tickets-Row-Inner-El-Xsm")},e.category.title)),a.createElement("span",{className:f("Tickets-Row-Inner-El")},e.price,"\u0440.")))})))),a.createElement("div",{className:f("Tickets-Row")},a.createElement("dt",null,"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c"),a.createElement("dd",null))))}))),a.createElement("form",{className:f("Footer"),action:"https://money.yandex.ru/eshop.xml",method:"post"},a.createElement("blockquote",null,"\u0418\u0442\u043e\u0433\u043e \u043a \u043e\u043f\u043b\u0430\u0442\u0435:"," ",t.reduce(function(e,t){return e+(t&&t.tickets?t.tickets.reduce(function(e,t){return e+(t.count?t.count:0)*Number(t.price)},0):0)},0),", promocode, submit"),a.createElement(p.a,{onClick:function(){return console.log(t)}},"\u041e\u043f\u043b\u0430\u0442\u0438\u0442\u044c")))))}),b=n(14),k=(n(178),n(30)),E=n(124),O=n.n(E),y=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={selected:void 0,visible:!1,dates:new Set,datesDefault:[]},n.setState=n.setState.bind(Object(b.a)(Object(b.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onChange",value:function(e){this.props.onChange(e.getTime()),this.setState({selected:e})}},{key:"updateProps",value:function(e){var t=this;if(e.dates){var n=new Date,a=new Date(n.getFullYear(),n.getMonth(),n.getDate()).valueOf(),r=e.dates.filter(function(e){return a<=t.dateFromApiFormat(e).valueOf()}),i=new Set(r);this.setState({dates:i}),r.length&&this.onChange(this.dateFromApiFormat(r[0]))}}},{key:"isEqualArrays",value:function(e,t){if(e.length!==t.length)return!1;for(var n in e){if(!e.hasOwnProperty(n)||!t.hasOwnProperty(n))return!1;if(e[n]!==t[n])return!1}return!0}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.isEqualArrays(e.dates,this.state.datesDefault)||this.setState({datesDefault:e.dates},function(){return t.updateProps(e)})}},{key:"componentDidMount",value:function(){var e=this;this.setState({datesDefault:this.props.dates},function(){return e.updateProps(e.props)})}},{key:"toTwoCharacterFormat",value:function(e){return e>=10?String(e):"0".concat(e)}},{key:"dateToApiFormat",value:function(e){return e?"".concat(this.toTwoCharacterFormat(e.getDate()),".").concat(this.toTwoCharacterFormat(e.getMonth()+1),".").concat(String(e.getFullYear())):""}},{key:"dateFromApiFormat",value:function(e){try{var t=e.split(".");return new Date(Number(t[2]),Number(t[1])-1,Number(t[0]))}catch(n){return console.warn(n),new Date(0)}}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{onClick:function(){return e.setState(function(e){return{visible:!e.visible}})},value:this.dateToApiFormat(this.state.selected),readOnly:!0}),this.state.visible&&r.a.createElement(O.a,{minDate:new Date,onChange:function(t){t instanceof Date&&e.onChange(t)},value:this.state.selected,tileDisabled:function(t){var n=t.date,a=e.dateToApiFormat(n);return!e.state.dates.has(a)}}))}}]),t}(r.a.Component),g=(n(195),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).updateValue=n.updateValue.bind(Object(b.a)(Object(b.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"updateValue",value:function(e){this.props.handleTicket(Object.assign({},Object(k.a)({},this.props.ticket,{ticket:this.props.ticket.ticket[0]}),{count:e}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.ticket,a=t.count;return r.a.createElement("li",null,n.ticket.map(function(e){return e.title}).join(" + "),"\xa0\xa0 (",n.category.title,"), \xa0\xa0",n.price," \u20bd \xa0\xa0",r.a.createElement("button",{disabled:0===a,onClick:function(){return e.updateValue(a>0?a-1:0)}},"-"),"\xa0\xa0",a,"\xa0\xa0",r.a.createElement("button",{onClick:function(){return e.updateValue(a+1)}},"+"))}}]),t}(a.PureComponent)),j=n(196)({projectId:"39dycnz5",dataset:"develop",token:"skvoyfx7KcGcy2Z9ratz9tHx0tgiWTUUdKzOX718S8Yg0hjvaCXAcZAZ44NJwrYqfs3AxL2f9uxZhOhZaEyqpXUWRsR1Zj3Tbp5R3y4FFLieMZBAs0zILNDkU5iP62udT10yG8M0tgXixm3n7RnGEoJnEXGpZ1xzYlbpBzUgnCmWNP12lTs5",useCdn:!1,ignoreBrowserWarning:!0}),T=Object(i.cn)("Service"),w=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={orders:[],service:{},order:{},tickets:[],id:n.props.id},n.handleDate=n.handleDate.bind(Object(b.a)(Object(b.a)(n))),n.handleDirection=n.handleDirection.bind(Object(b.a)(Object(b.a)(n))),n.handleTicket=n.handleTicket.bind(Object(b.a)(Object(b.a)(n))),n.handleTime=n.handleTime.bind(Object(b.a)(Object(b.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"updateFromStore",value:function(){var e=this;if(this.props.orders){var t=this.props.orders.find(function(t){var n=e.state.order,a=n.time,r=n.direction;return String(new Date(t.time||0))===String(new Date(a||0))&&r===t.direction})||null;if(console.log({order:t}),t){var n=t.tickets||[];this.setState({tickets:n})}}}},{key:"handleDate",value:function(e){console.log("handleDate");var t=new Date(e);this.setState({tickets:[],order:Object(k.a)({},this.state.order,{date:new Date(t.getFullYear(),t.getMonth(),t.getDate()).valueOf()})},this.updateFromStore)}},{key:"handleDirection",value:function(e){console.log("handleDirection"),this.setState({tickets:[],order:Object(k.a)({},this.state.order,{direction:e.target.value})},this.updateFromStore)}},{key:"handleTime",value:function(e){console.log("handleTime"),this.setState({tickets:[],order:Object(k.a)({},this.state.order,{time:e})},this.updateFromStore)}},{key:"handleTicket",value:function(e){var t=this,n=this.state.tickets.filter(function(t){return t._key!==e._key}).concat(e);this.setState({tickets:n},function(){t.props.serviceUpdate(Object(k.a)({},t.state),t.props.sessionId)})}},{key:"getService",value:function(){var e='*[_id == "'.concat(this.props.id,'"] {title, "directions": directions[]{..., "tickets": tickets[]{..., "category": category->, "ticket": ticket[]->}}}[0]');return j.fetch(e,{})}},{key:"componentWillReceiveProps",value:function(e){this.state.orders!==e.orders&&this.setState({orders:e.orders},this.updateFromStore)}},{key:"componentDidMount",value:function(){var e=this;this.getService().then(function(t){var n=Object(k.a)({},e.state);n.service=t,n.order.direction=t.directions?t.directions[0]._key:"",e.setState(n)})}},{key:"render",value:function(){var e=this,t=this.state,n=t.service,r=n.title,i=n.directions,c=t.order,o=(c.isOpenDate,c.isOpenTime,c.date),s=c.direction,l=i&&i.filter(function(e){return e._key===s})[0],u=l&&l.schedule.flatMap(function(e){return e.actions.map(function(e){return new Date(e.start).toLocaleDateString()})}),d=o&&l&&l.schedule.flatMap(function(e){return e.actions.map(function(e){return new Date(e.start)})}).filter(function(e){return new Date(o)<e&&new Date(o+864e5)>=e});if(d&&d.length){var m=this.state.order.time;(!m||this.state.order&&!d.find(function(e){return e.valueOf()===m.valueOf()}))&&setTimeout(function(){return e.handleTime(d[0])},1)}var h=l&&l.tickets&&l.tickets.reduce(function(e,t){return e[t.category.name.current]=e[t.category.name.current]||[],e[t.category.name.current].push(t),e},Object.create(null));return a.createElement("div",{className:T()},r&&a.createElement("h3",{className:T("Title")},r.ru.name),u&&a.createElement(y,{dates:u,onChange:this.handleDate}),a.createElement("div",{className:T("Directions")},i&&i.length>1?a.createElement("select",{onChange:this.handleDirection,value:s},i.map(function(e,t){return a.createElement("option",{value:e._key,key:e._key||t},e.title)})):i&&a.createElement(a.Fragment,null,a.createElement("input",{type:"hidden",name:"direction",value:i[0]._key}),a.createElement("select",{disabled:!0,value:i[0]._key},a.createElement("option",{value:i[0]._key,key:i[0]._key},i[0].title)))),a.createElement("div",{className:T("Times")},a.createElement("ul",null,d&&d.map(function(t,n){return a.createElement("li",{key:t.toLocaleTimeString()},a.createElement("label",{htmlFor:t.toLocaleTimeString()},a.createElement("input",{type:"radio",id:t.toLocaleTimeString(),value:t.toLocaleTimeString(),name:r?r.ru.name+s:"",defaultChecked:!n,onChange:function(){return e.handleTime(t)}}),t.toLocaleTimeString()))}))),a.createElement("div",{className:T("Tickets")},a.createElement("ul",null,h&&Object.keys(h).map(function(t){return a.createElement("li",{key:t},a.createElement("h4",null,t),a.createElement("ul",null,h[t].map(function(t){var n=e.state.tickets.find(function(e){return e._key===t._key}),r=n&&n.count?n.count:0;return a.createElement(g,{ticket:t,count:r,key:t._key,handleTicket:e.handleTicket})})))}))))}}]),t}(a.PureComponent),N=Object(h.b)(function(e,t){return console.log(e.order.orders),{orders:e.order.orders.filter(function(e){return e.id===t.id})||[],sessionId:e.session.sessionId}},function(e){return{serviceUpdate:function(t,n){return function(e,t,n){if(n){var a=J.getState().order,r=a.created;if(Object.keys(t.tickets).length&&t.order.date){var i=Object.values(t.tickets).filter(function(e){return e.count}),c=a.orders.filter(function(e){return!(e.id===t.id&&String(new Date(e.time||0))===String(new Date(t.order.time||0))&&e.direction===t.order.direction)});i.length&&t.service.title&&(c=c.concat({title:t.service.title.ru.name,date:new Date(t.order.date),time:t.order.time,isOpenDate:!1,isOpenTime:!1,tickets:i,direction:t.order.direction,id:t.id})),e({type:"SERVICE_UPDATE",payload:{orders:c}}),fetch("http://api.nevatrip.ru/shoppingCarts/".concat(n),{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({sessionId:n,created:r,lastUpdated:new Date,items:c.map(function(e){return{serviceId:e.id,options:e}})})})}}}(e,t,n)}}})(w),D=n(304),S=(n(269),Object(i.cn)("Fieldset")),C=function(e){var t=e.className,n=e.title,r=e.children;return a.createElement("fieldset",{className:S(null,[t])},n&&a.createElement("legend",{className:S("Legend")},n,":"),a.createElement("div",{className:S("Content")},r))},F=(n(270),Object(i.cn)("FormField")),R=function(e){var t=e.className,n=e.title,r=e.children;return a.createElement("div",{className:F(null,[t])},n&&a.createElement("label",{className:F("Label")},n,":"),r)},I=Object(i.cn)("Order"),_={textField:{position:"relative"},input:{background:"#FFFFFF",border:"1px solid #C4C4C4",borderRadius:"3px",width:"235px",height:"40px",fontSize:"14px",letterSpacing:"0.04em"}},x=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleEmail=n.handleEmail.bind(Object(b.a)(Object(b.a)(n))),n.handleName=n.handleName.bind(Object(b.a)(Object(b.a)(n))),n.handlePhone=n.handlePhone.bind(Object(b.a)(Object(b.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleEmail",value:function(e){console.log(e)}},{key:"handleName",value:function(e){console.log(e)}},{key:"handlePhone",value:function(e){console.log(e)}},{key:"render",value:function(){var e=this.props.cart;return a.createElement("div",{className:I("Content")},a.createElement(C,{title:"\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"},a.createElement(R,{title:"\u0412\u0430\u0448 email"},a.createElement(D.a,{InputProps:{style:_.input},placeholder:"info@email.com",type:"email",onChange:this.handleEmail})),a.createElement(R,{title:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f \u0438\xa0\u0444\u0430\u043c\u0438\u043b\u0438\u044f"},a.createElement(D.a,{InputProps:{style:_.input},placeholder:"\u0418\u0432\u0430\u043d \u0418\u0432\u0430\u043d\u043e\u0432",type:"text",onChange:this.handleName})),a.createElement(R,{title:"\u0412\u0430\u0448 \u0442\u0435\u043b\u0435\u0444\u043e\u043d"},a.createElement(D.a,{InputProps:{style:_.input},placeholder:"+7 (9__) ___-__-__",type:"tel",onChange:this.handlePhone}))),a.createElement("ul",{className:I("List")},(e.items||[]).map(function(e,t){return a.createElement("li",{className:I("Item"),key:e.id||String(t)},a.createElement(N,e))})))}}]),t}(a.Component),P=(n(278),Object(i.cn)("Order")),A=function(e){function t(e){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.cart,n=e.isLoading;return r.a.createElement("div",{className:P()},n?r.a.createElement(x,{cart:t}):"Loading\u2026",r.a.createElement(v,null))}}]),t}(a.PureComponent),L=n(79),U=n(43),M=Object(U.b)({order:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{orders:[],created:new Date},t=arguments.length>1?arguments[1]:void 0;return t.type,t.payload?{orders:t.payload.orders,created:t.payload.created||e.created}:e},session:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sessionId:null},t=arguments.length>1?arguments[1]:void 0;return"SET_SESSION_ID"===t.type?Object(k.a)({},e,{sessionId:t.payload}):e}});n.d(t,"b",function(){return J}),n.d(t,"a",function(){return X});var W,Z,z=Object(i.cn)("Page"),V=document.getElementById("root"),B=V&&V.dataset.sessionid,J=Object(U.c)(M,{session:{sessionId:B}});W=J.dispatch,(Z=B||null)&&fetch("http://api.nevatrip.ru/shoppingCarts/".concat(Z),{method:"GET",headers:{}}).then(function(e){return e.json().then(function(e){return e&&e.items&&function(e,t,n){e({type:"SERVICE_UPDATE",payload:{orders:t,created:n}})}(W,e.items.map(function(e){return e.options||{}}),new Date(e.created))})});var X=function(e){return a.createElement(h.a,{store:J},a.createElement(c.RegistryConsumer,null,function(e){e.platform.get(Object(o.b)());return a.createElement(a.Fragment,null,a.createElement("div",{className:z("Content")},a.createElement(A,{isLoading:!!L,cart:L})))}))}},66:function(e,t,n){"use strict";var a=n(0),r=n(13),i=n(28);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n.d(t,"a",function(){return c}),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()});var c=function(e,t){var n=Object(i.withRegistry)(t)(e),c=document.getElementById("root");r.render(a.createElement(n,{store:{hello:["world"]}}),c)}},79:function(e){e.exports={user:{sessionId:"123123123asd",name:"Ivan Ivanov"},items:[{id:"41b1283d-2ad1-4894-b03e-368042e5d301"},{id:"fea7f5c0-4c97-4a60-af87-3c916986786f"}]}}},[[128,1,2]]]);